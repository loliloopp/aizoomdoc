{
  "pdf_path": "C:/Users/kuklev.d.s/Downloads/01-04-03-00-06 КР3.pdf",
  "pages": [
    {
      "page_number": 0,
      "width": 2481,
      "height": 3508,
      "blocks": []
    },
    {
      "page_number": 1,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "7LPV-EU9J-WJQ",
          "page_index": 1,
          "coords_px": [
            221,
            455,
            2366,
            1440
          ],
          "coords_norm": [
            0.08907698508665861,
            0.1297035347776511,
            0.9536477226924627,
            0.4104903078677309
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "A9DD-4VWF-3N9",
          "page_index": 1,
          "coords_px": [
            325,
            1498,
            1619,
            1979
          ],
          "coords_norm": [
            0.1309955663039097,
            0.42702394526795895,
            0.6525594518339379,
            0.564139110604333
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "6GMC-WFX9-MVE",
          "page_index": 1,
          "coords_px": [
            204,
            2025,
            2418,
            3267
          ],
          "coords_norm": [
            0.08222490931076179,
            0.5772519954389966,
            0.9746070133010882,
            0.9312998859749145
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 2,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "NKRL-3HU9-TXT",
          "page_index": 2,
          "coords_px": [
            297,
            67,
            2404,
            2107
          ],
          "coords_norm": [
            0.11970979443772672,
            0.01909920182440137,
            0.9689641273679968,
            0.6006271379703535
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "6P6A-7MDY-XVV",
          "page_index": 2,
          "coords_px": [
            903,
            2950,
            2408,
            3447
          ],
          "coords_norm": [
            0.3639661426844015,
            0.8409350057012542,
            0.9705763804917372,
            0.9826111744583809
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 3,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "4CFR-QEL9-4V3",
          "page_index": 3,
          "coords_px": [
            308,
            146,
            2393,
            1016
          ],
          "coords_norm": [
            0.12414349052801289,
            0.04161915621436716,
            0.9645304312777107,
            0.2896237172177879
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "647K-JJ43-QCG",
          "page_index": 3,
          "coords_px": [
            918,
            2954,
            2405,
            3432
          ],
          "coords_norm": [
            0.37001209189842804,
            0.8420752565564424,
            0.9693671906489318,
            0.9783352337514253
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 4,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "9MKE-ULJC-ML9",
          "page_index": 4,
          "coords_px": [
            293,
            127,
            2401,
            2928
          ],
          "coords_norm": [
            0.1180975413139863,
            0.03620296465222349,
            0.9677549375251915,
            0.8346636259977195
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "7JCD-MLEY-JQG",
          "page_index": 4,
          "coords_px": [
            1035,
            3252,
            2408,
            3406
          ],
          "coords_norm": [
            0.41717049576783555,
            0.927023945267959,
            0.9705763804917372,
            0.9709236031927024
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 5,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "AC7W-7PCV-DYR",
          "page_index": 5,
          "coords_px": [
            282,
            124,
            2393,
            3221
          ],
          "coords_norm": [
            0.11366384522370013,
            0.03534777651083238,
            0.9645304312777107,
            0.9181870011402509
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "6GNJ-NYL9-U36",
          "page_index": 5,
          "coords_px": [
            1023,
            3255,
            2393,
            3436
          ],
          "coords_norm": [
            0.41233373639661425,
            0.92787913340935,
            0.9645304312777107,
            0.9794754846066135
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 6,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "6EQ7-PWWT-GX6",
          "page_index": 6,
          "coords_px": [
            304,
            146,
            2386,
            3252
          ],
          "coords_norm": [
            0.12253123740427246,
            0.04161915621436716,
            0.9617089883111648,
            0.927023945267959
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "A9XL-7VAY-XYR",
          "page_index": 6,
          "coords_px": [
            1027,
            3248,
            2393,
            3421
          ],
          "coords_norm": [
            0.4139459895203547,
            0.9258836944127709,
            0.9645304312777107,
            0.9751995438996579
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 7,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "4L7V-RWWF-GL3",
          "page_index": 7,
          "coords_px": [
            308,
            82,
            2412,
            3218
          ],
          "coords_norm": [
            0.12414349052801289,
            0.023375142531356898,
            0.9721886336154776,
            0.9173318129988598
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "6TEQ-J4V7-EEX",
          "page_index": 7,
          "coords_px": [
            1016,
            3236,
            2408,
            3440
          ],
          "coords_norm": [
            0.4095122934300685,
            0.9224629418472063,
            0.9705763804917372,
            0.9806157354618016
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 8,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "7GL6-CQXY-X7U",
          "page_index": 8,
          "coords_px": [
            282,
            107,
            2412,
            315
          ],
          "coords_norm": [
            0.11366384522370013,
            0.03050171037628278,
            0.9721886336154776,
            0.08979475484606614
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "9QXJ-7ELH-NYH",
          "page_index": 8,
          "coords_px": [
            269,
            317,
            2421,
            3214
          ],
          "coords_norm": [
            0.10842402257154374,
            0.0903648802736602,
            0.9758162031438936,
            0.9161915621436716
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "7TJF-REYA-WYU",
          "page_index": 8,
          "coords_px": [
            1012,
            3235,
            2401,
            3444
          ],
          "coords_norm": [
            0.4079000403063281,
            0.9221778791334093,
            0.9677549375251915,
            0.9817559863169898
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 9,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "779M-3ATP-M4Y",
          "page_index": 9,
          "coords_px": [
            266,
            48,
            2402,
            3251
          ],
          "coords_norm": [
            0.10721483272873841,
            0.013683010262257697,
            0.9681580008061266,
            0.9267388825541619
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "99UH-PR9Q-TGG",
          "page_index": 9,
          "coords_px": [
            1017,
            3228,
            2425,
            3442
          ],
          "coords_norm": [
            0.40991535671100365,
            0.9201824401368301,
            0.977428456267634,
            0.9811858608893956
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 10,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "6WXA-LUAM-ADA",
          "page_index": 10,
          "coords_px": [
            263,
            48,
            2402,
            3169
          ],
          "coords_norm": [
            0.10600564288593309,
            0.013683010262257697,
            0.9681580008061266,
            0.9033637400228051
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "77HJ-V3YT-QYR",
          "page_index": 10,
          "coords_px": [
            1027,
            3215,
            2435,
            3462
          ],
          "coords_norm": [
            0.4139459895203547,
            0.9164766248574686,
            0.9814590890769851,
            0.9868871151653363
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 11,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "79EY-K6KV-JFF",
          "page_index": 11,
          "coords_px": [
            276,
            65,
            2435,
            3108
          ],
          "coords_norm": [
            0.11124546553808948,
            0.018529076396807297,
            0.9814590890769851,
            0.8859749144811858
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "H99K-CXTN-TRP",
          "page_index": 11,
          "coords_px": [
            1004,
            3195,
            2480,
            3475
          ],
          "coords_norm": [
            0.40467553405884726,
            0.9107753705815279,
            0.9995969367190649,
            0.9905929304446979
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 12,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "7H6P-RFD4-P4R",
          "page_index": 12,
          "coords_px": [
            250,
            52,
            2386,
            3160
          ],
          "coords_norm": [
            0.1007658202337767,
            0.014823261117445839,
            0.9617089883111648,
            0.9007981755986317
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "9WQ9-JVC3-HJG",
          "page_index": 12,
          "coords_px": [
            1033,
            3215,
            2431,
            3442
          ],
          "coords_norm": [
            0.4163643692059653,
            0.9164766248574686,
            0.9798468359532446,
            0.9811858608893956
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 13,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "49W4-NX6J-AG9",
          "page_index": 13,
          "coords_px": [
            295,
            65,
            2418,
            3244
          ],
          "coords_norm": [
            0.1189036678758565,
            0.018529076396807297,
            0.9746070133010882,
            0.9247434435575826
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 14,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "9EUP-FA9Q-EXG",
          "page_index": 14,
          "coords_px": [
            298,
            88,
            2374,
            3174
          ],
          "coords_norm": [
            0.12011285771866183,
            0.02508551881413911,
            0.9568722289399436,
            0.9047890535917902
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "4HT9-6EJ7-FWD",
          "page_index": 14,
          "coords_px": [
            1011,
            3220,
            2420,
            3431
          ],
          "coords_norm": [
            0.407496977025393,
            0.9179019384264538,
            0.9754131398629585,
            0.9780501710376283
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "category_id": "fd6ce354-3699-47de-8e14-15f1fd42fd2d",
          "category_code": "stamp"
        }
      ]
    },
    {
      "page_number": 15,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "L9FC-AQTV-TN3",
          "page_index": 15,
          "coords_px": [
            306,
            80,
            2423,
            3224
          ],
          "coords_norm": [
            0.12333736396614269,
            0.02280501710376283,
            0.9766223297057638,
            0.9190421892816419
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "7FP4-KLGM-9DH",
          "page_index": 15,
          "coords_px": [
            1003,
            3247,
            2416,
            3450
          ],
          "coords_norm": [
            0.4042724707779121,
            0.9255986316989738,
            0.973800886739218,
            0.9834663625997719
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "category_id": "fd6ce354-3699-47de-8e14-15f1fd42fd2d",
          "category_code": "stamp"
        }
      ]
    },
    {
      "page_number": 16,
      "width": 2481,
      "height": 3508,
      "blocks": [
        {
          "id": "6LDJ-KVDQ-P7F",
          "page_index": 16,
          "coords_px": [
            264,
            38,
            2481,
            2217
          ],
          "coords_norm": [
            0.10640870616686819,
            0.010832383124287344,
            1.0,
            0.6319840364880274
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "A7CN-TMER-LYR",
          "page_index": 16,
          "coords_px": [
            1022,
            3205,
            2424,
            3435
          ],
          "coords_norm": [
            0.41193067311567916,
            0.9136259977194983,
            0.9770253929866989,
            0.9791904218928165
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "category_id": "fd6ce354-3699-47de-8e14-15f1fd42fd2d",
          "category_code": "stamp"
        }
      ]
    },
    {
      "page_number": 17,
      "width": 7017,
      "height": 4963,
      "blocks": [
        {
          "id": "6DWC-C7TX-KUF",
          "page_index": 17,
          "coords_px": [
            4603,
            2051,
            6955,
            3304
          ],
          "coords_norm": [
            0.6559783383212199,
            0.4132581100141044,
            0.9911643152344307,
            0.6657263751763046
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          },
          "group_id": "UX6Y-XQ43-HN6"
        },
        {
          "id": "4LPV-4M9Y-UKR",
          "page_index": 17,
          "coords_px": [
            4594,
            1003,
            6951,
            1916
          ],
          "coords_norm": [
            0.6546957389197663,
            0.20209550674994964,
            0.9905942710560068,
            0.38605682047148904
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "group_id": "UX6Y-XQ43-HN6"
        },
        {
          "id": "7WMT-WFDT-NJL",
          "page_index": 17,
          "coords_px": [
            320,
            143,
            4539,
            4676
          ],
          "coords_norm": [
            0.045603534273906225,
            0.028813217811807373,
            0.6468576314664386,
            0.9421720733427362
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "group_id": "UX6Y-XQ43-HN6"
        },
        {
          "id": "9NDH-LVNY-HKF",
          "page_index": 17,
          "coords_px": [
            4750,
            3577,
            6963,
            4914
          ],
          "coords_norm": [
            0.6769274618782956,
            0.7207334273624824,
            0.9923044035912784,
            0.9901269393511989
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "category_id": "fd6ce354-3699-47de-8e14-15f1fd42fd2d",
          "category_code": "stamp"
        }
      ]
    },
    {
      "page_number": 18,
      "width": 9934,
      "height": 7017,
      "blocks": [
        {
          "id": "4K6U-6QR7-499",
          "page_index": 18,
          "coords_px": [
            6126,
            55,
            9878,
            3540
          ],
          "coords_norm": [
            0.6166700221461647,
            0.007838107453327633,
            0.994362794443326,
            0.5044890979050877
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          },
          "group_id": "6da90445-8da8-4a95-ab6b-140489b14b2c",
          "group_name": "ограждение котлована"
        },
        {
          "id": "J7CP-QLQJ-VX3",
          "page_index": 18,
          "coords_px": [
            7764,
            3603,
            9885,
            4736
          ],
          "coords_norm": [
            0.7815582846788807,
            0.5134672937152629,
            0.9950674451379102,
            0.6749323072538121
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "group_id": "9TWP-EHJQ-FKF"
        },
        {
          "id": "4PWK-APNY-KWY",
          "page_index": 18,
          "coords_px": [
            8109,
            4731,
            9870,
            5503
          ],
          "coords_norm": [
            0.8162874974833904,
            0.6742197520307824,
            0.9935574793638011,
            0.7842382784665811
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "group_id": "9TWP-EHJQ-FKF"
        },
        {
          "id": "46YG-XMRX-NH4",
          "page_index": 18,
          "coords_px": [
            257,
            4560,
            3432,
            6974
          ],
          "coords_norm": [
            0.02587074692973626,
            0.6498503634031637,
            0.3454801691161667,
            0.9938720250819438
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "group_id": "9TWP-EHJQ-FKF"
        },
        {
          "id": "7HEG-KTRC-JHK",
          "page_index": 18,
          "coords_px": [
            3485,
            4802,
            5273,
            5178
          ],
          "coords_norm": [
            0.35081538151801894,
            0.6843380361978053,
            0.530803301791826,
            0.7379221889696451
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "group_id": "9TWP-EHJQ-FKF"
        },
        {
          "id": "9XH3-TUPG-7VE",
          "page_index": 18,
          "coords_px": [
            233,
            182,
            6217,
            4532
          ],
          "coords_norm": [
            0.023454801691161667,
            0.025937010118284167,
            0.62583048117576,
            0.645860054154197
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          },
          "group_id": "6da90445-8da8-4a95-ab6b-140489b14b2c",
          "group_name": "ограждение котлована"
        },
        {
          "id": "RV3G-4DG3-PTL",
          "page_index": 18,
          "coords_px": [
            8332,
            6295,
            9874,
            6949
          ],
          "coords_norm": [
            0.8387356553251459,
            0.8971070257944991,
            0.9939601369035636,
            0.990309248966795
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "9MG3-LNTQ-RC9",
          "page_index": 18,
          "coords_px": [
            4378,
            4903,
            7328,
            6934
          ],
          "coords_norm": [
            0.44070867726998186,
            0.698731651703007,
            0.7376686128447755,
            0.9881715832977056
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "polygon",
          "image_file": null,
          "ocr_text": null,
          "polygon_points": [
            [
              4487,
              5325
            ],
            [
              5450,
              4903
            ],
            [
              6859,
              4914
            ],
            [
              7328,
              5673
            ],
            [
              7201,
              6531
            ],
            [
              6841,
              6934
            ],
            [
              4629,
              6920
            ],
            [
              4378,
              6397
            ],
            [
              4440,
              5612
            ],
            [
              4509,
              5474
            ]
          ],
          "linked_block_id": "7ELD-PG3H-QT6",
          "group_id": "9TWP-EHJQ-FKF"
        }
      ]
    },
    {
      "page_number": 19,
      "width": 9934,
      "height": 7017,
      "blocks": [
        {
          "id": "9J9K-CXL9-7J3",
          "page_index": 19,
          "coords_px": [
            241,
            85,
            6361,
            4566
          ],
          "coords_norm": [
            0.02426011677068653,
            0.012113438791506342,
            0.6403261526072076,
            0.6507054296707995
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          },
          "linked_block_id": "646L-XQDG-3DY"
        },
        {
          "id": "47H3-TVDK-YDD",
          "page_index": 19,
          "coords_px": [
            6382,
            54,
            9901,
            3671
          ],
          "coords_norm": [
            0.6424401046909604,
            0.007695596408721676,
            0.99667807529696,
            0.523158044748468
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "9KAY-QJPN-CTJ",
          "page_index": 19,
          "coords_px": [
            3485,
            4812,
            5253,
            5141
          ],
          "coords_norm": [
            0.35081538151801894,
            0.685763146643865,
            0.5287900140930138,
            0.7326492803192247
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "6FKD-LQVY-CDK",
          "page_index": 19,
          "coords_px": [
            237,
            4567,
            3492,
            6948
          ],
          "coords_norm": [
            0.0238574592309241,
            0.6508479407154054,
            0.3515200322126032,
            0.990166737922189
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "linked_block_id": "7AX9-DMPW-TWW"
        },
        {
          "id": "4NAN-RDU6-FLN",
          "page_index": 19,
          "coords_px": [
            4322,
            4865,
            7194,
            6998
          ],
          "coords_norm": [
            0.43507147171330784,
            0.6933162320079806,
            0.7241795852627341,
            0.9972922901524868
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "polygon",
          "image_file": null,
          "ocr_text": null,
          "polygon_points": [
            [
              4480,
              5371
            ],
            [
              5447,
              4865
            ],
            [
              6982,
              4922
            ],
            [
              7194,
              5936
            ],
            [
              7083,
              6723
            ],
            [
              6641,
              6995
            ],
            [
              4619,
              6998
            ],
            [
              4322,
              6277
            ],
            [
              4439,
              5677
            ]
          ]
        },
        {
          "id": "7MW4-J4GL-4QX",
          "page_index": 19,
          "coords_px": [
            7700,
            6109,
            8651,
            6285
          ],
          "coords_norm": [
            0.7751157640426817,
            0.8705999714977911,
            0.8708475941211999,
            0.8956819153484396
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "643P-PH9C-CYM",
          "page_index": 19,
          "coords_px": [
            7677,
            6308,
            9894,
            6973
          ],
          "coords_norm": [
            0.7728004831890477,
            0.8989596693743765,
            0.9959734246023757,
            0.9937295140373379
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 20,
      "width": 9934,
      "height": 7017,
      "blocks": [
        {
          "id": "4MLK-CNUC-LCG",
          "page_index": 20,
          "coords_px": [
            6174,
            98,
            9868,
            3770
          ],
          "coords_norm": [
            0.6215019126233139,
            0.013966082371383783,
            0.9933561505939199,
            0.5372666381644577
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "6ULG-3DUW-TRF",
          "page_index": 20,
          "coords_px": [
            240,
            54,
            6218,
            4535
          ],
          "coords_norm": [
            0.024159452385745923,
            0.007695596408721676,
            0.6259311455607006,
            0.6462875872880148
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "6XE3-AF3R-MWY",
          "page_index": 20,
          "coords_px": [
            8334,
            6297,
            9883,
            6971
          ],
          "coords_norm": [
            0.8389369840950271,
            0.897392047883711,
            0.994866116368029,
            0.993444491948126
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "VXHK-TXN3-3PW",
          "page_index": 20,
          "coords_px": [
            247,
            4551,
            3525,
            6956
          ],
          "coords_norm": [
            0.02486410308033018,
            0.6485677640017101,
            0.35484195691564324,
            0.9913068262790367
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "47XQ-P9MC-GP7",
          "page_index": 20,
          "coords_px": [
            3491,
            4809,
            5244,
            5126
          ],
          "coords_norm": [
            0.3514193678276626,
            0.685335613510047,
            0.5278840346285484,
            0.7305116146501354
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 21,
      "width": 9934,
      "height": 7017,
      "blocks": [
        {
          "id": "6XAM-AFDQ-DU7",
          "page_index": 21,
          "coords_px": [
            251,
            76,
            6349,
            4721
          ],
          "coords_norm": [
            0.025266760620092612,
            0.01083083939005273,
            0.6391181799879203,
            0.6727946415847228
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "6VQT-PGRW-4TT",
          "page_index": 21,
          "coords_px": [
            6349,
            1169,
            9857,
            5027
          ],
          "coords_norm": [
            0.6391181799879203,
            0.1665954111443637,
            0.9922488423595732,
            0.7164030212341457
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "4JXW-UYMH-6PK",
          "page_index": 21,
          "coords_px": [
            7681,
            129,
            9930,
            1092
          ],
          "coords_norm": [
            0.7732031407288101,
            0.01838392475416845,
            0.9995973424602376,
            0.155622060709705
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "7FPU-TUNG-K6V",
          "page_index": 21,
          "coords_px": [
            193,
            5069,
            902,
            5546
          ],
          "coords_norm": [
            0.019428226293537347,
            0.7223884851075958,
            0.09079927521642843,
            0.7903662533846373
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "7PYT-6PUK-LHU",
          "page_index": 21,
          "coords_px": [
            1057,
            5089,
            7329,
            6957
          ],
          "coords_norm": [
            0.10640225488222267,
            0.725238705999715,
            0.7377692772297161,
            0.9914493373236426
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "7RNK-TEV4-XAW",
          "page_index": 21,
          "coords_px": [
            8335,
            6301,
            9880,
            6955
          ],
          "coords_norm": [
            0.8390376484799678,
            0.8979620920621348,
            0.9945641232132072,
            0.9911643152344307
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 22,
      "width": 9934,
      "height": 7017,
      "blocks": [
        {
          "id": "7JPA-EY9X-T66",
          "page_index": 22,
          "coords_px": [
            8329,
            6313,
            9877,
            6965
          ],
          "coords_norm": [
            0.8384336621703241,
            0.8996722245974063,
            0.9942621300583854,
            0.9925894256804902
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "KLXK-Q6NR-MMK",
          "page_index": 22,
          "coords_px": [
            7775,
            66,
            9907,
            999
          ],
          "coords_norm": [
            0.7826655929132273,
            0.00940572894399316,
            0.9972820616066036,
            0.142368533561351
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "6PTC-KXC6-JUM",
          "page_index": 22,
          "coords_px": [
            6346,
            1239,
            9899,
            5024
          ],
          "coords_norm": [
            0.6388161868330985,
            0.17657118426678067,
            0.9964767465270787,
            0.7159754881003277
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "4A7C-U7UG-QL3",
          "page_index": 22,
          "coords_px": [
            3098,
            4586,
            4487,
            6982
          ],
          "coords_norm": [
            0.3118582645460036,
            0.6535556505629186,
            0.45168109522850813,
            0.9950121134387915
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "7HGL-KXEH-N6V",
          "page_index": 22,
          "coords_px": [
            207,
            5050,
            968,
            5343
          ],
          "coords_norm": [
            0.02083752768270586,
            0.7196807752600827,
            0.09744312462250855,
            0.7614365113296281
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "6QJC-LKGT-PN6",
          "page_index": 22,
          "coords_px": [
            142,
            76,
            6281,
            4580
          ],
          "coords_norm": [
            0.014294342661566338,
            0.01083083939005273,
            0.6322730018119589,
            0.6527005842952829
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        }
      ]
    },
    {
      "page_number": 23,
      "width": 9934,
      "height": 7017,
      "blocks": [
        {
          "id": "94EL-JRT9-9XT",
          "page_index": 23,
          "coords_px": [
            262,
            152,
            6415,
            4742
          ],
          "coords_norm": [
            0.0263740688544393,
            0.02166167878010546,
            0.6457620293940004,
            0.6757873735214479
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "7MGC-NN4E-WNT",
          "page_index": 23,
          "coords_px": [
            6458,
            1289,
            9846,
            5081
          ],
          "coords_norm": [
            0.6500905979464465,
            0.18369673649707852,
            0.9911415341252265,
            0.7240986176428673
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "4ALL-QDRM-M93",
          "page_index": 23,
          "coords_px": [
            262,
            5016,
            4426,
            6906
          ],
          "coords_norm": [
            0.0263740688544393,
            0.7148353997434801,
            0.4455405677471311,
            0.9841812740487388
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "63AA-JYWG-96N",
          "page_index": 23,
          "coords_px": [
            7767,
            118,
            9874,
            963
          ],
          "coords_norm": [
            0.7818602778337025,
            0.016816303263502922,
            0.9939601369035636,
            0.13723813595553655
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "6R79-3U3P-LPW",
          "page_index": 23,
          "coords_px": [
            8340,
            6294,
            9872,
            6951
          ],
          "coords_norm": [
            0.8395409704046708,
            0.8969645147498931,
            0.9937588081336823,
            0.9905942710560068
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 24,
      "width": 9934,
      "height": 7017,
      "blocks": [
        {
          "id": "7P6F-EHVV-N4F",
          "page_index": 24,
          "coords_px": [
            240,
            87,
            5005,
            3781
          ],
          "coords_norm": [
            0.024159452385745923,
            0.012398460880718255,
            0.5038252466277431,
            0.5388342596551233
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "AA7C-EECF-XJN",
          "page_index": 24,
          "coords_px": [
            5387,
            65,
            9835,
            3967
          ],
          "coords_norm": [
            0.5422790416750554,
            0.009263217899387203,
            0.9900342258908799,
            0.5653413139518313
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "3HYX-N66M-PHP",
          "page_index": 24,
          "coords_px": [
            244,
            3765,
            4835,
            6941
          ],
          "coords_norm": [
            0.024562109925508356,
            0.5365540829414279,
            0.48671230118783976,
            0.9891691606099473
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "9T6V-43YM-HQL",
          "page_index": 24,
          "coords_px": [
            4735,
            4081,
            5597,
            6855
          ],
          "coords_norm": [
            0.47664586269377895,
            0.5815875730369103,
            0.563418562512583,
            0.976913210773835
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "7QCN-4FPW-MRF",
          "page_index": 24,
          "coords_px": [
            5604,
            4103,
            9722,
            6251
          ],
          "coords_norm": [
            0.5641232132071673,
            0.5847228160182414,
            0.9786591503925911,
            0.890836539831837
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "9F3J-XDYX-477",
          "page_index": 24,
          "coords_px": [
            8335,
            6317,
            9866,
            6948
          ],
          "coords_norm": [
            0.8390376484799678,
            0.9002422687758301,
            0.9931548218240387,
            0.990166737922189
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 25,
      "width": 9934,
      "height": 7017,
      "blocks": [
        {
          "id": "A7VJ-RWLV-NL9",
          "page_index": 25,
          "coords_px": [
            5584,
            57,
            7542,
            2330
          ],
          "coords_norm": [
            0.5621099255083551,
            0.008123129542539546,
            0.7592107912220656,
            0.3320507339318797
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          },
          "group_id": "12f781ad-1c07-4ec6-84a1-3a0cb42c6893",
          "group_name": "разрез 4-4"
        },
        {
          "id": "4CYL-4HGR-FKW",
          "page_index": 25,
          "coords_px": [
            1090,
            54,
            3173,
            3169
          ],
          "coords_norm": [
            0.10972417958526273,
            0.007695596408721676,
            0.31940809341654924,
            0.4516175003562776
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          },
          "hint": "Скажина 7",
          "group_id": "9cddaaba-6934-4954-b3c2-07abcd25428c",
          "group_name": "Разрез 3-3"
        },
        {
          "id": "4XPC-XQWD-N7A",
          "page_index": 25,
          "coords_px": [
            636,
            3563,
            2606,
            5701
          ],
          "coords_norm": [
            0.0640225488222267,
            0.5077668519310247,
            0.26233138715522447,
            0.8124554652985606
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          },
          "group_id": "91575088-64cd-44af-8167-ebd7d0f22d7b",
          "group_name": "разрез 5-5"
        },
        {
          "id": "6JR3-9M7V-YXX",
          "page_index": 25,
          "coords_px": [
            4432,
            4033,
            4947,
            6827
          ],
          "coords_norm": [
            0.4461445540567747,
            0.5747470428958245,
            0.49798671230118785,
            0.9729229015248682
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          },
          "hint": "скважина 2"
        },
        {
          "id": "6GQH-AR9D-X4P",
          "page_index": 25,
          "coords_px": [
            163,
            3933,
            728,
            7017
          ],
          "coords_norm": [
            0.016408294745319105,
            0.5604959384352287,
            0.07328367223676263,
            1.0
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          },
          "hint": "скважина 1"
        },
        {
          "id": "93HC-7NFJ-FHM",
          "page_index": 25,
          "coords_px": [
            7667,
            6198,
            8465,
            6281
          ],
          "coords_norm": [
            0.7717938393396416,
            0.8832834544677213,
            0.8521240185222468,
            0.8951118711700157
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "9XXC-P7NK-7AD",
          "page_index": 25,
          "coords_px": [
            2610,
            3562,
            4538,
            5777
          ],
          "coords_norm": [
            0.2627340446949869,
            0.5076243408864187,
            0.45681497886047917,
            0.8232863046886134
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "group_id": "91575088-64cd-44af-8167-ebd7d0f22d7b",
          "group_name": "разрез 5-5"
        },
        {
          "id": "9DDU-U9QJ-NJ9",
          "page_index": 25,
          "coords_px": [
            5301,
            3522,
            7283,
            5955
          ],
          "coords_norm": [
            0.5336219045701631,
            0.5019238991021804,
            0.7331387155224481,
            0.8486532706284737
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "group_id": "820d28bd-bba5-4b7b-b2de-599858f8a516",
          "group_name": "разрез 6-6"
        },
        {
          "id": "FGDK-6GFM-WHW",
          "page_index": 25,
          "coords_px": [
            7257,
            3554,
            9408,
            5951
          ],
          "coords_norm": [
            0.7305214415139923,
            0.5064842525295711,
            0.9470505335212401,
            0.8480832264500499
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "polygon",
          "image_file": null,
          "ocr_text": null,
          "polygon_points": [
            [
              9408,
              5942
            ],
            [
              9347,
              3922
            ],
            [
              8453,
              3922
            ],
            [
              8365,
              3733
            ],
            [
              7870,
              3742
            ],
            [
              7840,
              3554
            ],
            [
              7415,
              3593
            ],
            [
              7287,
              4031
            ],
            [
              7257,
              4272
            ],
            [
              7257,
              4356
            ],
            [
              7314,
              4382
            ],
            [
              7353,
              5951
            ],
            [
              9408,
              5946
            ]
          ],
          "group_id": "820d28bd-bba5-4b7b-b2de-599858f8a516",
          "group_name": "разрез 6-6"
        },
        {
          "id": "63AY-6VNA-YRW",
          "page_index": 25,
          "coords_px": [
            7257,
            2429,
            9847,
            3784
          ],
          "coords_norm": [
            0.7305214415139923,
            0.34615932734786947,
            0.9912421985101671,
            0.5392617927889412
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "polygon",
          "image_file": null,
          "ocr_text": null,
          "polygon_points": [
            [
              7267,
              2429
            ],
            [
              9847,
              2434
            ],
            [
              9837,
              3759
            ],
            [
              8507,
              3784
            ],
            [
              8497,
              3537
            ],
            [
              7756,
              3517
            ],
            [
              7720,
              3558
            ],
            [
              7363,
              3542
            ],
            [
              7257,
              2434
            ]
          ],
          "linked_block_id": "743L-GUCL-PFM"
        },
        {
          "id": "743L-GUCL-PFM",
          "page_index": 25,
          "coords_px": [
            7257,
            2429,
            9847,
            3784
          ],
          "coords_norm": [
            0.7305214415139923,
            0.34615932734786947,
            0.9912421985101671,
            0.5392617927889412
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "polygon",
          "image_file": null,
          "ocr_text": null,
          "polygon_points": [
            [
              7267,
              2429
            ],
            [
              9847,
              2434
            ],
            [
              9837,
              3759
            ],
            [
              8507,
              3784
            ],
            [
              8497,
              3537
            ],
            [
              7756,
              3517
            ],
            [
              7720,
              3558
            ],
            [
              7363,
              3542
            ],
            [
              7257,
              2434
            ]
          ],
          "linked_block_id": "63AY-6VNA-YRW"
        },
        {
          "id": "744K-V697-WTJ",
          "page_index": 25,
          "coords_px": [
            3144,
            70,
            5214,
            3264
          ],
          "coords_norm": [
            0.31648882625327157,
            0.009975773122416987,
            0.5248641030803302,
            0.46515604959384355
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "group_id": "9cddaaba-6934-4954-b3c2-07abcd25428c",
          "group_name": "Разрез 3-3"
        },
        {
          "id": "9A9D-QHX4-VLX",
          "page_index": 25,
          "coords_px": [
            240,
            398,
            710,
            3050
          ],
          "coords_norm": [
            0.024159452385745923,
            0.05671939575317087,
            0.07147171330783168,
            0.4346586860481687
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "9QE7-GUP6-ADK",
          "page_index": 25,
          "coords_px": [
            710,
            420,
            1093,
            3103
          ],
          "coords_norm": [
            0.07147171330783168,
            0.059854638734501926,
            0.11002617274008455,
            0.44221177141228446
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "hint": "Скважина 11"
        },
        {
          "id": "9UH4-A99Q-NX9",
          "page_index": 25,
          "coords_px": [
            5214,
            507,
            5579,
            3163
          ],
          "coords_norm": [
            0.5248641030803302,
            0.07225309961522018,
            0.5616066035836521,
            0.45076243408864186
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "hint": "Скважина 5"
        },
        {
          "id": "6TH4-WD77-QAD",
          "page_index": 25,
          "coords_px": [
            7527,
            71,
            9830,
            2339
          ],
          "coords_norm": [
            0.7577008254479565,
            0.010118284167022944,
            0.9895309039661767,
            0.3333333333333333
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "group_id": "12f781ad-1c07-4ec6-84a1-3a0cb42c6893",
          "group_name": "разрез 4-4"
        },
        {
          "id": "4JVP-FTM3-QWM",
          "page_index": 25,
          "coords_px": [
            4938,
            4027,
            5350,
            6818
          ],
          "coords_norm": [
            0.4970807328367224,
            0.5738919766281887,
            0.5385544594322529,
            0.9716403021234146
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "hint": "скважина 3"
        },
        {
          "id": "6AVT-3AQJ-CCT",
          "page_index": 25,
          "coords_px": [
            7671,
            6292,
            9888,
            6954
          ],
          "coords_norm": [
            0.7721964968794041,
            0.8966794926606813,
            0.9953694382927321,
            0.9910218041898247
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "category_id": "fd6ce354-3699-47de-8e14-15f1fd42fd2d",
          "category_code": "stamp"
        }
      ]
    },
    {
      "page_number": 26,
      "width": 9934,
      "height": 7017,
      "blocks": [
        {
          "id": "6K79-HF7R-JUF",
          "page_index": 26,
          "coords_px": [
            653,
            109,
            5125,
            2574
          ],
          "coords_norm": [
            0.06573384336621703,
            0.015533703862049308,
            0.5159049728206161,
            0.3668234288157332
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "6U46-7V4T-TRK",
          "page_index": 26,
          "coords_px": [
            5835,
            229,
            9857,
            2950
          ],
          "coords_norm": [
            0.5873766861284477,
            0.03263502921476415,
            0.9922488423595732,
            0.420407581587573
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "9TUT-7RUW-4YK",
          "page_index": 26,
          "coords_px": [
            5212,
            426,
            5966,
            2983
          ],
          "coords_norm": [
            0.5246627743104489,
            0.06070970500213767,
            0.6005637205556674,
            0.4251104460595696
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "9G6J-UWTM-7MK",
          "page_index": 26,
          "coords_px": [
            218,
            437,
            743,
            3289
          ],
          "coords_norm": [
            0.021944835917052548,
            0.062277326492803195,
            0.07479363801087176,
            0.4687188257089924
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "7DKV-W4DW-UTJ",
          "page_index": 26,
          "coords_px": [
            431,
            3430,
            4205,
            5542
          ],
          "coords_norm": [
            0.04338634990940205,
            0.4888128829984324,
            0.4232937386752567,
            0.7897962092062135
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "6FJ3-K7LR-TKA",
          "page_index": 26,
          "coords_px": [
            268,
            5717,
            2730,
            6760
          ],
          "coords_norm": [
            0.026978055164082946,
            0.8147356420122559,
            0.27481377088785985,
            0.963374661536269
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "7JLM-VFCK-N7D",
          "page_index": 26,
          "coords_px": [
            4693,
            3297,
            9056,
            5908
          ],
          "coords_norm": [
            0.4724179585262734,
            0.4698589140658401,
            0.9116166700221462,
            0.8419552515319937
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "63PJ-DMU4-WHU",
          "page_index": 26,
          "coords_px": [
            4255,
            3759,
            4834,
            6933
          ],
          "coords_norm": [
            0.4283269579222871,
            0.5356990166737923,
            0.48661163680289915,
            0.9880290722530997
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "7VHE-JE4P-9DF",
          "page_index": 26,
          "coords_px": [
            8334,
            6298,
            9879,
            6973
          ],
          "coords_norm": [
            0.8389369840950271,
            0.8975345589283169,
            0.9944634588282666,
            0.9937295140373379
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 27,
      "width": 9934,
      "height": 7017,
      "blocks": []
    },
    {
      "page_number": 28,
      "width": 9934,
      "height": 7017,
      "blocks": [
        {
          "id": "9JHV-WNKP-LPH",
          "page_index": 28,
          "coords_px": [
            165,
            50,
            4900,
            2205
          ],
          "coords_norm": [
            0.016609623515200324,
            0.007125552230297848,
            0.49325548620897924,
            0.3142368533561351
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "6W3N-FDMY-RVX",
          "page_index": 28,
          "coords_px": [
            4914,
            50,
            9643,
            2320
          ],
          "coords_norm": [
            0.49466478759814775,
            0.007125552230297848,
            0.9707066639822831,
            0.33062562348582014
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "7GUE-4RFQ-HXV",
          "page_index": 28,
          "coords_px": [
            104,
            2328,
            2774,
            4608
          ],
          "coords_norm": [
            0.010469096033823233,
            0.3317657118426678,
            0.27924300382524664,
            0.6566908935442497
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "6FLA-YE3T-AFK",
          "page_index": 28,
          "coords_px": [
            2774,
            2280,
            7013,
            4913
          ],
          "coords_norm": [
            0.27924300382524664,
            0.32492518170158186,
            0.705959331588484,
            0.7001567621490665
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "64MJ-6UW9-6LE",
          "page_index": 28,
          "coords_px": [
            161,
            5112,
            2803,
            6908
          ],
          "coords_norm": [
            0.01620696597543789,
            0.728516460025652,
            0.28216227098852426,
            0.9844662961379507
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "EAHW-JLNT-AWF",
          "page_index": 28,
          "coords_px": [
            5245,
            5378,
            7069,
            6803
          ],
          "coords_norm": [
            0.527984699013489,
            0.7664243978908365,
            0.711596537145158,
            0.9695026364543252
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "44DW-J7JF-NQ3",
          "page_index": 28,
          "coords_px": [
            2926,
            5150,
            4865,
            6794
          ],
          "coords_norm": [
            0.29454399033621903,
            0.7339318797206783,
            0.489732232736058,
            0.9682200370528716
          ],
          "block_type": "image",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null,
          "prompt": {
            "system": "System role\nЭксперт по анализу строительной рабочей документации и САПР-чертежей (планы/схемы/узлы/разрезы/фасады/спецификации/штампы). Задача — извлекать признаки для индексации и поиска без домыслов.\nSystem prompt (обновлённый)\nТебе передают:\nизображение (тайл/кроп) большого листа;\nдополнительный контекст:\noperator_hint — подсказка пользователя о фрагменте (может быть неточной);\npdfplumber_text — извлечённый текст из PDF (может быть шумным и содержать текст не из этого фрагмента).\nЦель: вернуть метаданные для индексации, краткое смысловое описание и подробное наблюдаемое техническое описание визуального содержимого.\nПриоритеты источников:\nИзображение — главный источник фактов (геометрия, графика, тип зоны, видимые подписи/обозначения).\noperator_hint — только как подсказка; если противоречит изображению, игнорируй противоречащую часть.\npdfplumber_text используй ТОЛЬКО если он явно относится к этому фрагменту (совпадают марки/заголовки/позиции/оси/обозначения). Если текст выглядит общестраничным — не переноси его целиком.\nАнти-галлюцинации (жёстко):\nНичего не выдумывай и не “дочитывай”.\nЕсли признак/текст не виден на изображении и не подтверждён релевантным pdfplumber_text — не добавляй.\nНе делай выводов (назначение, материал, конструкция) без прямых признаков. Пиши только наблюдения.\nЕсли есть сомнение в символах/числах — пропусти или сформулируй как “неразборчиво/неопределимо”.\nФормат ответа — строго чистый JSON (без ``` и без пояснений), ровно по схеме:\n{\n\"location\": {\n\"grid_lines\": \"строка (например, 'Оси 1-5 / А-В' или 'Не определены')\",\n\"zone_name\": \"строка (ОДНА категория: 'План этажа' | 'Схема' | 'Разрез' | 'Фасад' | 'Узел' | 'Спецификация' | 'Экспликация' | 'Легенда' | 'Штамп' | 'Примечания' | 'График/Диаграмма' | 'Не определено')\"\n},\n\"content_summary\": \"1–2 предложения: что это и к какому разделу похоже относится (АР/КР/ОВ/ВК/ЭОМ/СС). Указывай только то, что обосновано.\",\n\"detailed_description\": \"строка (Подробное техническое описание визуального содержимого (3-5 предложений). Опиши геометрию: типы линий (сплошные, пунктирные), наличие штриховок (бетон, грунт, кирпич), графические примитивы (выноски, размеры, отметки уровня). Опиши топологию: взаимосвязь элементов (напр. 'труба подходит к коллектору', 'стена с оконным проемом'). Если есть условные обозначения - то используй их в т.ч. для описания. Не делай выводов, только факты наблюдения.)\",\n\"ocr_text\": \"Текст для полнотекстового поиска. Если дан pdfplumber_text — используй ЕГО как основу и приведи к читабельному виду. Если текста нет — пустая строка.\",\n\"key_entities\": [\n\"До 25 уникальных сущностей: марки/коды/позиции/диаметры/DN/Ø/отметки/размеры/RAL/наименования оборудования/кабелей/труб. Без мусора и дублей.\"\n]\n}\nПравила заполнения:\ngrid_lines: только если видишь оси/координатную сетку на фрагменте ИЛИ это явно указано в релевантном pdfplumber_text и согласуется с изображением. Иначе “Не определены”.\nzone_name: выбирай ОДНУ наиболее подходящую категорию.\ncontent_summary: не переписывай operator_hint; используй его только для уточнения типа, если он не противоречит изображению.\ndetailed_description:\nстрого 3–5 предложений;\nтолько наблюдаемое на изображении (линии/штриховки/стрелки/выноски/размеры/отметки/условные обозначения/сечения/контуры/узлы);\nописывай связи элементов (что к чему подведено/примыкает/пересекает/огибает/врезается), но без предположений “зачем”;\nесли штриховка/тип материала не распознаётся уверенно — пиши нейтрально (“штриховка присутствует, тип неразличим”).\nocr_text:\nесли pdfplumber_text релевантен: очисти повторы и мусорные переносы, сохрани исходные формулировки, не добавляй отсутствующее;\nесли нерелевантен/пуст: ocr_text = \"\";\nесли это таблица/спецификация/тех. данные — представь как структурированный текст:\n“Позиция N: …”\n“### Группа”\n“- Параметр: Значение”\nНЕ используй таблицы с | и ---.\nkey_entities:\nтолько подтверждённое (видно на изображении или подтверждено релевантным pdfplumber_text);\nбез дублей и мусора; максимум 25;\nесли сомневаешься в точности значения — не включай.",
            "user": "Контекст (используй как подсказку, может быть неточным):\ndoc_name: {DOC_NAME}\npage: {PAGE_OR_NULL}\ntile_id: {TILE_ID_OR_NULL}\ntile_hint: {TILE_HINT_OR_NULL} // например: \"overview\" | \"detail\" | \"узел\" | \"штамп\"\noperator_hint: {OPERATOR_HINT_OR_EMPTY}\nИзвлечённый текст pdfplumber (может быть шумным/общестраничным):\n{PDFPLUMBER_TEXT_OR_EMPTY}\nЗадача: проанализируй приложенный фрагмент изображения и верни чистый JSON по схеме из System.\nОграничения:\nНе выполняй полный OCR (поле ocr_text оставляй пустым, если нет 100% уверенного короткого ключевого текста).\nСфокусируйся на content_summary, detailed_description, zone_name и key_entities."
          }
        },
        {
          "id": "6HJ7-JHF7-HUP",
          "page_index": 28,
          "coords_px": [
            8342,
            6318,
            9892,
            6994
          ],
          "coords_norm": [
            0.839742299174552,
            0.9003847798204361,
            0.9957720958324945,
            0.996722245974063
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        },
        {
          "id": "6LWR-V3DF-Q36",
          "page_index": 28,
          "coords_px": [
            7638,
            6005,
            8842,
            6319
          ],
          "coords_norm": [
            0.768874572176364,
            0.8557788228587716,
            0.8900744916448561,
            0.900527290865042
          ],
          "block_type": "text",
          "source": "user",
          "shape_type": "rectangle",
          "image_file": null,
          "ocr_text": null
        }
      ]
    },
    {
      "page_number": 29,
      "width": 2480,
      "height": 3507,
      "blocks": []
    },
    {
      "page_number": 30,
      "width": 2480,
      "height": 3507,
      "blocks": []
    },
    {
      "page_number": 31,
      "width": 2475,
      "height": 3505,
      "blocks": []
    },
    {
      "page_number": 32,
      "width": 2475,
      "height": 3505,
      "blocks": []
    },
    {
      "page_number": 33,
      "width": 2475,
      "height": 3505,
      "blocks": []
    },
    {
      "page_number": 34,
      "width": 2475,
      "height": 3505,
      "blocks": []
    },
    {
      "page_number": 35,
      "width": 2475,
      "height": 3505,
      "blocks": []
    },
    {
      "page_number": 36,
      "width": 2475,
      "height": 3505,
      "blocks": []
    },
    {
      "page_number": 37,
      "width": 2475,
      "height": 3505,
      "blocks": []
    },
    {
      "page_number": 38,
      "width": 2475,
      "height": 3505,
      "blocks": []
    },
    {
      "page_number": 39,
      "width": 2475,
      "height": 3505,
      "blocks": []
    },
    {
      "page_number": 40,
      "width": 2475,
      "height": 3505,
      "blocks": []
    },
    {
      "page_number": 41,
      "width": 2475,
      "height": 3505,
      "blocks": []
    }
  ]
}