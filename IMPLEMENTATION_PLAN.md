# –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò: Supabase + S3 Cloud.ru –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–ª–∞–Ω–∞

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–¥–∞–Ω–Ω—ã—Ö)
3. [–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
4. [–°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#—Å–æ–∑–¥–∞–Ω–Ω—ã–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
5. [–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è](#–ø–æ—à–∞–≥–æ–≤–∞—è-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)
6. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
7. [–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã](#—á–∞—Å—Ç–æ-–∑–∞–¥–∞–≤–∞–µ–º—ã–µ-–≤–æ–ø—Ä–æ—Å—ã)

---

## –û–±–∑–æ—Ä

### –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:

**1. Supabase (PostgreSQL)**
- –•—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –∏ –∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π (user –∏ assistant)
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
- –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π

**2. S3 Cloud.ru (Object Storage)**
- –•—Ä–∞–Ω–µ–Ω–∏–µ viewport –∫–∞—Ä—Ç–∏–Ω–æ–∫
- –•—Ä–∞–Ω–µ–Ω–∏–µ zoom crop –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ —á–∞—Ç–∞–º

**3. Python –º–æ–¥—É–ª–∏**
- `src/supabase_client.py` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ë–î
- `src/s3_storage.py` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è S3
- `src/config.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º–æ–π –ë–î

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚úÖ **–ò—Å—Ç–æ—Ä–∏—è** - –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —á–∞—Ç–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚úÖ **–ü–æ–∏—Å–∫** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–∫–∞—Ç—å –ø–æ —á–∞—Ç–∞–º –∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º
‚úÖ **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ backup –≤ Supabase
‚úÖ **Multi-user** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚úÖ **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### üìä –°—Ö–µ–º–∞ –ë–î

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   CHATS                                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ id (UUID) - PRIMARY KEY                                 ‚îÇ
‚îÇ title (VARCHAR) - –Ω–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞                         ‚îÇ
‚îÇ description (TEXT) - –æ–ø–∏—Å–∞–Ω–∏–µ                           ‚îÇ
‚îÇ created_at (TIMESTAMP) - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è                 ‚îÇ
‚îÇ updated_at (TIMESTAMP) - –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è               ‚îÇ
‚îÇ user_id (VARCHAR) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                    ‚îÇ
‚îÇ is_archived (BOOLEAN) - –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω –ª–∏                 ‚îÇ
‚îÇ document_path (VARCHAR) - –ø—É—Ç—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É –≤ S3        ‚îÇ
‚îÇ metadata (JSONB) - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ              ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ INDEXES:                                               ‚îÇ
‚îÇ   - idx_chats_user_id                                  ‚îÇ
‚îÇ   - idx_chats_created_at                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚îÇ (1:N) 
            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               CHAT_MESSAGES                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ id (UUID) - PRIMARY KEY                                 ‚îÇ
‚îÇ chat_id (UUID) - FOREIGN KEY ‚Üí chats.id                ‚îÇ
‚îÇ role (VARCHAR) - 'user' –∏–ª–∏ 'assistant'                ‚îÇ
‚îÇ content (TEXT) - —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è                       ‚îÇ
‚îÇ message_type (VARCHAR) - 'text', 'code', –∏ —Ç.–¥.       ‚îÇ
‚îÇ created_at (TIMESTAMP) - –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏                ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ INDEXES:                                               ‚îÇ
‚îÇ   - idx_chat_messages_chat_id                          ‚îÇ
‚îÇ   - idx_chat_messages_created_at                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚îÇ (1:N)
            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                CHAT_IMAGES                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ id (UUID) - PRIMARY KEY                                 ‚îÇ
‚îÇ chat_id (UUID) - FOREIGN KEY ‚Üí chats.id                ‚îÇ
‚îÇ message_id (UUID) - FOREIGN KEY ‚Üí chat_messages.id     ‚îÇ
‚îÇ image_name (VARCHAR) - –∏–º—è —Ñ–∞–π–ª–∞                       ‚îÇ
‚îÇ s3_path (VARCHAR) - –ø—É—Ç—å –≤ S3                          ‚îÇ
‚îÇ s3_url (VARCHAR) - –ø—É–±–ª–∏—á–Ω—ã–π URL S3                    ‚îÇ
‚îÇ image_type (VARCHAR) - 'viewport', 'zoom_crop' –∏ —Ç.–¥. ‚îÇ
‚îÇ description (TEXT) - –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏                 ‚îÇ
‚îÇ width (INT) - —à–∏—Ä–∏–Ω–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö                        ‚îÇ
‚îÇ height (INT) - –≤—ã—Å–æ—Ç–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö                       ‚îÇ
‚îÇ file_size (INT) - —Ä–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö                      ‚îÇ
‚îÇ uploaded_at (TIMESTAMP) - –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏               ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ INDEXES:                                               ‚îÇ
‚îÇ   - idx_chat_images_chat_id                            ‚îÇ
‚îÇ   - idx_chat_images_message_id                         ‚îÇ
‚îÇ   - idx_chat_images_s3_path                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              SEARCH_RESULTS                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ id (UUID) - PRIMARY KEY                                 ‚îÇ
‚îÇ chat_id (UUID) - FOREIGN KEY ‚Üí chats.id                ‚îÇ
‚îÇ message_id (UUID) - FOREIGN KEY ‚Üí chat_messages.id     ‚îÇ
‚îÇ block_id (VARCHAR) - ID –±–ª–æ–∫–∞ –∏–∑ annotation.json       ‚îÇ
‚îÇ page_number (INT) - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã                     ‚îÇ
‚îÇ block_text (TEXT) - –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç                    ‚îÇ
‚îÇ coords_norm (JSONB) - –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã       ‚îÇ
‚îÇ coords_px (JSONB) - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –ø–∏–∫—Å–µ–ª—è—Ö              ‚îÇ
‚îÇ created_at (TIMESTAMP) - –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞                  ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ INDEXES:                                               ‚îÇ
‚îÇ   - idx_search_results_chat_id                         ‚îÇ
‚îÇ   - idx_search_results_message_id                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ S3

```
cloud-aizoomdoc (bucket)
‚îÇ
‚îú‚îÄ‚îÄ chats/
‚îÇ   ‚îú‚îÄ‚îÄ {uuid-chat-1}/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ documents/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ document_2025-12-18T10-30-45.pdf
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ images/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ viewport_step_1.png
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ viewport_step_2.png
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ zoom_crop_1_2025-12-18T10-31-05.png
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ {uuid-chat-2}/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ documents/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ images/
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îî‚îÄ‚îÄ uploads/
    ‚îú‚îÄ‚îÄ documents/
    ‚îÇ   ‚îî‚îÄ‚îÄ {user-uploaded-pdfs}
    ‚îÇ
    ‚îî‚îÄ‚îÄ temp/
        ‚îî‚îÄ‚îÄ {temporary-files}
```

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### ‚úÖ –ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `.env`:

```ini
# ============================================
# Supabase Configuration
# ============================================
# –ü–æ–ª—É—á–∏—Ç—å –Ω–∞ https://supabase.com/

# URL –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ Supabase
SUPABASE_URL=https://your-project-id.supabase.co

# –ê–Ω–æ–Ω–∏–º–Ω—ã–π –∫–ª—é—á (–ø—É–±–ª–∏—á–Ω—ã–π)
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# –°–µ—Ä–≤–∏—Å –∫–ª—é—á (–¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –¥–µ—Ä–∂–∞—Ç—å –≤ —Å–µ–∫—Ä–µ—Ç–µ!)
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# –ü–æ–ª–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è PostgreSQL
DATABASE_URL=postgresql://postgres:your_password@db.your-project-id.supabase.co:5432/postgres

# ============================================
# S3 Cloud.ru Configuration
# ============================================
# –ü–æ–ª—É—á–∏—Ç—å –Ω–∞ https://cloud.ru/

# Endpoint S3
S3_ENDPOINT=https://s3.cloud.ru

# –ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞
S3_ACCESS_KEY=your-access-key-here

# –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
S3_SECRET_KEY=your-secret-key-here

# –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞
S3_BUCKET=cloud-aizoomdoc

# –†–µ–≥–∏–æ–Ω
S3_REGION=ru-1

# ============================================
# Database and Storage Settings
# ============================================
# –í–∫–ª—é—á–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –≤ –ë–î (true/false)
USE_DATABASE=true

# –í–∫–ª—é—á–∏—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ S3 (true/false)
USE_S3_STORAGE=true

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ (–≤ –ú–ë)
MAX_FILE_SIZE_MB=100

# –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ URL (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 —á–∞—Å)
S3_URL_EXPIRATION=3600

# –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ë–î –æ–ø–µ—Ä–∞—Ü–∏–π
DATABASE_LOG_LEVEL=ERROR
```

### –ì–¥–µ –Ω–∞–π—Ç–∏ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è:

**Supabase:**
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ https://supabase.com/
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π—Ç–∏ –≤ Settings ‚Üí Project API keys
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `Project URL` –∏ `anon public key`
5. –î–ª—è `DATABASE_URL`: Settings ‚Üí Database ‚Üí Connection string (PostgreSQL)

**S3 Cloud.ru:**
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ https://cloud.ru/
2. –°–æ–∑–¥–∞—Ç—å S3 –±–∞–∫–µ—Ç
3. –°–æ–∑–¥–∞—Ç—å API –∫–ª—é—á–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ API Keys
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Access Key –∏ Secret Key

---

## –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1Ô∏è‚É£ `src/config.py` (–æ–±–Ω–æ–≤–ª–µ–Ω–∞)
–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `SUPABASE_URL`, `SUPABASE_ANON_KEY`, `SUPABASE_SERVICE_KEY`
- `DATABASE_URL`, `USE_DATABASE`
- `S3_ENDPOINT`, `S3_ACCESS_KEY`, `S3_SECRET_KEY`, `S3_BUCKET`, `S3_REGION`
- `USE_S3_STORAGE`, `MAX_FILE_SIZE_MB`, `S3_URL_EXPIRATION`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 2Ô∏è‚É£ `src/supabase_client.py` (–Ω–æ–≤—ã–π)
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Supabase:
- ‚úÖ –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —á–∞—Ç–∞–º–∏ (create, get, get_list, update, archive)
- ‚úÖ –ú–µ—Ç–æ–¥—ã –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π (add, get_all)
- ‚úÖ –ú–µ—Ç–æ–¥—ã –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ (add_image, get_images_by_message)
- ‚úÖ –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ (add_result, get_results)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3Ô∏è‚É£ `src/s3_storage.py` (–Ω–æ–≤—ã–π)
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π S3 –∫–ª–∏–µ–Ω—Ç –¥–ª—è cloud.ru:
- ‚úÖ Upload —Ñ–∞–π–ª–æ–≤ (–∏–∑ –ø—É—Ç–∏ –∏–ª–∏ file object)
- ‚úÖ Download —Ñ–∞–π–ª–æ–≤ —Å S3
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö URLs
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–æ–≤

### 4Ô∏è‚É£ `migrations/versions/001_initial_schema.py` (–Ω–æ–≤—ã–π)
–ú–∏–≥—Ä–∞—Ü–∏—è Alembic —Å –ø–æ–ª–Ω–æ–π —Å—Ö–µ–º–æ–π –ë–î:
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `chats`
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `chat_messages`
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `chat_images`
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `search_results`
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –∏ constraints

### 5Ô∏è‚É£ `scripts/manage_db.py` (–Ω–æ–≤—ã–π)
–°–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏:
- ‚úÖ `python scripts/manage_db.py init` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ `python scripts/manage_db.py migrate "message"` - –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
- ‚úÖ `python scripts/manage_db.py upgrade` - –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ `python scripts/manage_db.py downgrade revision` - –æ—Ç–∫–∞—Ç–∏—Ç—å
- ‚úÖ `python scripts/manage_db.py history` - –∏—Å—Ç–æ—Ä–∏—è
- ‚úÖ `python scripts/manage_db.py current` - —Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è

### 6Ô∏è‚É£ `requirements.txt` (–æ–±–Ω–æ–≤–ª–µ–Ω–∞)
–î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- `sqlalchemy>=2.0.0` - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- `alembic>=1.13.0` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- `psycopg2-binary>=2.9.0` - –¥—Ä–∞–π–≤–µ—Ä PostgreSQL
- `supabase>=2.4.0` - –∫–ª–∏–µ–Ω—Ç Supabase
- `boto3>=1.28.0` - AWS S3 SDK (—Å–æ–≤–º–µ—Å—Ç–∏–º —Å cloud.ru)
- `botocore>=1.31.0` - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å boto3

### 7Ô∏è‚É£ `env.example` (–æ–±–Ω–æ–≤–ª–µ–Ω–∞)
–î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏

### 8Ô∏è‚É£ `DATABASE_ARCHITECTURE.md`
–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ SQL –∑–∞–ø—Ä–æ—Å–æ–≤

### 9Ô∏è‚É£ `SUPABASE_S3_INTEGRATION.md`
–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### üîü `INTEGRATION_EXAMPLES.py`
–ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥

---

## –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# 1. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
# Windows:
venv\Scripts\activate
# MacOS/Linux:
source venv/bin/activate

# 2. –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install --upgrade pip
pip install -r requirements.txt

# 3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å .env
cp env.example .env
# –û—Ç–∫—Ä—ã—Ç—å .env –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å:
# - SUPABASE_URL
# - SUPABASE_ANON_KEY
# - DATABASE_URL
# - S3_ACCESS_KEY
# - S3_SECRET_KEY
# - S3_BUCKET
```

### –®–∞–≥ 2: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
python -c "from src.config import config; config.validate()"

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
python scripts/manage_db.py init

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
python scripts/manage_db.py current
```

### –®–∞–≥ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–¥

**–í `src/main.py` –∏–ª–∏ `src/gui.py`:**

```python
from src.supabase_client import supabase_client
from src.s3_storage import s3_storage

# –°–æ–∑–¥–∞—Ç—å —á–∞—Ç
chat_id = await supabase_client.create_chat(
    title="–ù–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑",
    user_id="user_123"
)

# –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
msg_id = await supabase_client.add_message(
    chat_id=chat_id,
    role="user",
    content="–ù–∞–π–¥–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é..."
)

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É
s3_url = await s3_storage.upload_file(
    file_path="/path/to/image.png",
    s3_key=f"chats/{chat_id}/images/image.png",
    content_type="image/png"
)

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞—Ä—Ç–∏–Ω–∫–µ
img_id = await supabase_client.add_image_to_message(
    chat_id=chat_id,
    message_id=msg_id,
    image_name="image.png",
    s3_path=f"chats/{chat_id}/images/image.png",
    s3_url=s3_url
)
```

### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç-—á–∞—Ç
python -c "
import asyncio
from src.supabase_client import supabase_client

async def test():
    chat = await supabase_client.create_chat(
        title='Test Chat',
        user_id='test_user'
    )
    print(f'‚úÖ Chat created: {chat}')

asyncio.run(test())
"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
python -c "
import asyncio
from src.supabase_client import supabase_client

async def test():
    chats = await supabase_client.get_chats('test_user')
    print(f'‚úÖ Chats: {len(chats)}')
    for chat in chats:
        print(f'  - {chat[\"title\"]}')

asyncio.run(test())
"
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π:

```python
# test_connections.py
import asyncio
from src.config import config
from src.supabase_client import supabase_client
from src.s3_storage import s3_storage

async def test_all():
    print("–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...")
    try:
        config.validate()
        print("‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è OK")
    except ValueError as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return
    
    print("\n–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î...")
    if supabase_client.is_connected():
        print("‚úÖ Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω")
    else:
        print("‚ùå Supabase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω")
    
    print("\n–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ S3...")
    if s3_storage.is_connected():
        print("‚úÖ S3 –ø–æ–¥–∫–ª—é—á–µ–Ω")
    else:
        print("‚ùå S3 –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω")
    
    print("\n–ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç-—á–∞—Ç...")
    try:
        chat_id = await supabase_client.create_chat(
            title="Test Chat",
            user_id="test_user"
        )
        if chat_id:
            print(f"‚úÖ –ß–∞—Ç —Å–æ–∑–¥–∞–Ω: {chat_id}")
        else:
            print("‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")

asyncio.run(test_all())
```

### Unit —Ç–µ—Å—Ç—ã (pytest):

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pytest
pip install pytest pytest-asyncio

# –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –≤ tests/test_db.py –∏ tests/test_s3.py
pytest tests/ -v
```

---

## –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### ‚ùì –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –ë–î –∏–ª–∏ S3?

–î–∞! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ `.env`:
```ini
USE_DATABASE=false
USE_S3_STORAGE=false
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ. –í—Å–µ –º–µ—Ç–æ–¥—ã –≤–µ—Ä–Ω—É—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ –æ—à–∏–±–æ–∫.

### ‚ùì –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –ë–î?

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
python scripts/manage_db.py migrate "add new column"

# 2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ migrations/versions/

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
python scripts/manage_db.py upgrade
```

### ‚ùì –ö–∞–∫ —É–¥–∞–ª–∏—Ç—å —á–∞—Ç –≤–º–µ—Å—Ç–µ —Å —Ñ–∞–π–ª–∞–º–∏?

```python
import asyncio
from src.supabase_client import supabase_client
from src.s3_storage import s3_storage

async def delete_chat(chat_id):
    # –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã –∏–∑ S3
    await s3_storage.delete_folder(f"chats/{chat_id}/")
    
    # –£–¥–∞–ª–∏—Ç—å –∏–∑ –ë–î (–∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
    # ... (—Ç—Ä–µ–±—É–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–æ–¥–∞ –≤ supabase_client)

asyncio.run(delete_chat("chat_id"))
```

### ‚ùì –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é?

**Supabase:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
- Settings ‚Üí Backups ‚Üí –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏

**S3:** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã cloud.ru –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:
```bash
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º S3
aws s3 sync s3://cloud-aizoomdoc s3://backup-bucket/
```

### ‚ùì –ö–∞–∫–∏–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω—É–∂–Ω—ã –¥–ª—è S3?

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞:
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:PutObject",
        "s3:GetObject",
        "s3:DeleteObject",
        "s3:ListBucket"
      ],
      "Resource": ["arn:aws:s3:::cloud-aizoomdoc/*", "arn:aws:s3:::cloud-aizoomdoc"]
    }
  ]
}
```

### ‚ùì –ö–∞–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –±–æ–ª—å—à–æ–≥–æ —á–∏—Å–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?

1. **–î–æ–±–∞–≤–∏—Ç—å RLS (Row Level Security)** –≤ Supabase - –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **–í–∫–ª—é—á–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - Redis –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã** –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å connection pooling** - PgBouncer —Å Supabase
5. **–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —á–∞—Ç—ã** - –º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üéØ –ß—Ç–æ –¥–∞–ª—å—à–µ?

1. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ GUI** - –¥–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–æ–≤
2. **–î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–∞ –≤ PDF/Markdown
3. **WebSocket** - real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è multi-user
4. **Analytics** - —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
5. **Search** - –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ —á–∞—Ç–∞–º

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- üìÑ [DATABASE_ARCHITECTURE.md](DATABASE_ARCHITECTURE.md) - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ë–î
- üìÑ [SUPABASE_S3_INTEGRATION.md](SUPABASE_S3_INTEGRATION.md) - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- üìÑ [INTEGRATION_EXAMPLES.py](INTEGRATION_EXAMPLES.py) - –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
- üìÑ [env.example](env.example) - –ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

## ‚ù§Ô∏è Support

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**: —Å–º–æ—Ç—Ä–∏—Ç–µ –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env**: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**: –∑–∞–ø—É—Å—Ç–∏—Ç–µ test script –≤—ã—à–µ
4. **–ß–∏—Ç–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**: –µ—Å—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏ —Ä–µ—à–µ–Ω–∏—è
5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ DEBUG**: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `LOG_LEVEL=DEBUG` –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ª–æ–≥–æ–≤

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-12-18
**–í–µ—Ä—Å–∏—è**: 1.0
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

